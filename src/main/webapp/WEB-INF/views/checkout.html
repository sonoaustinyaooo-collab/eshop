<!DOCTYPE html>
<!-- 宣告 HTML5 文件類型 -->
<html xmlns:th="http://www.thymeleaf.org">
<!-- xmlns:th 宣告 Thymeleaf 命名空間，讓我們可以使用 th: 開頭的屬性 -->
<head>
    <!-- meta 標籤設定網頁的元資訊 -->
    <meta charset="UTF-8">  <!-- 設定字元編碼為 UTF-8，支援中文 -->
    <title>結帳</title>  <!-- 瀏覽器標籤頁顯示的標題 -->
    
    <!-- 引入 Bootstrap CSS 框架，提供美化的樣式 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- 引入 Bootstrap Icons 圖示庫 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    
    <!-- 自訂樣式 -->
    <style>
        /* 卡片樣式 */
        .checkout-card {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);  /* 添加陰影效果 */
            border-radius: 8px;  /* 圓角 */
            padding: 20px;  /* 內邊距 */
        }
        
        /* 必填欄位標記 */
        .required {
            color: red;  /* 紅色 */
        }
    </style>
</head>
<body>
<!-- container 是 Bootstrap 的容器類別，會將內容置中並設定最大寬度 -->
<div class="container mt-4">  <!-- mt-4 = margin-top: 1.5rem -->

    <!-- 返回購物車按鈕 -->
    <!-- th:href 是 Thymeleaf 的屬性，用於生成 URL -->
    <!-- @{} 是 Thymeleaf 的 URL 表達式，會自動加上 context path -->
    <a th:href="@{/cart}" class="btn btn-secondary mb-3">
        <!-- <i> 標籤用於顯示圖示 -->
        <i class="bi bi-arrow-left"></i> 返回購物車
    </a>

    <!-- 頁面標題 -->
    <h1 class="mb-4">
        <i class="bi bi-credit-card"></i> 結帳
    </h1>

    <!-- 錯誤訊息顯示區 -->
    <!-- th:if 是 Thymeleaf 的條件判斷，當條件為 true 時顯示此元素 -->
    <!-- ${error} 從 Model 中取得 error 屬性的值 -->
    <div th:if="${error}" class="alert alert-danger" role="alert">
        <!-- alert 是 Bootstrap 的警告框樣式 -->
        <!-- alert-danger 是紅色的警告框（用於錯誤訊息） -->
        <i class="bi bi-exclamation-triangle"></i> 
        <!-- th:text 將標籤的文字內容設定為指定的值 -->
        錯誤：<span th:text="${error}"></span>
    </div>

    <!-- 主要內容區 -->
    <div class="row">
        
        <!-- 左側：填寫收貨資訊 -->
        <div class="col-md-7">
            <div class="checkout-card">
                <h3 class="mb-3">收貨資訊</h3>
                
                <!-- 表單：提交收貨資訊 -->
                <!-- th:action 設定表單提交的目標 URL -->
                <!-- method="post" 使用 POST 方法提交表單 -->
                <form th:action="@{/orders/create}" method="post">
                    
                    <!-- 收貨人姓名欄位 -->
                    <div class="mb-3">  <!-- mb-3 = margin-bottom -->
                        <!-- <label> 標籤用於顯示欄位名稱 -->
                        <!-- for 屬性關聯到對應的 input 的 id -->
                        <label for="recipientName" class="form-label">
                            收貨人姓名 <span class="required">*</span>
                            <!-- * 表示必填欄位 -->
                        </label>
                        <!-- <input> 是輸入框 -->
                        <!-- type="text" 表示文字輸入框 -->
                        <!-- class="form-control" 是 Bootstrap 的樣式類別 -->
                        <!-- id 是此元素的唯一識別碼 -->
                        <!-- name 是提交表單時的參數名稱（對應 Controller 的 @RequestParam） -->
                        <!-- required 表示此欄位必填 -->
                        <input type="text" 
                               class="form-control" 
                               id="recipientName" 
                               name="recipientName" 
                               placeholder="請輸入收貨人姓名" 
                               required>
                    </div>

                    <!-- 收貨人電話欄位 -->
                    <div class="mb-3">
                        <label for="recipientPhone" class="form-label">
                            收貨人電話 <span class="required">*</span>
                        </label>
                        <!-- type="tel" 表示電話輸入框，在手機上會顯示數字鍵盤 -->
                        <!-- pattern 是正規表達式，用於驗證輸入格式 -->
                        <input type="tel" 
                               class="form-control" 
                               id="recipientPhone" 
                               name="recipientPhone" 
                               placeholder="例如：0912345678" 
                               pattern="[0-9]{10}" 
                               required>
                        <!-- <small> 標籤用於顯示輔助說明文字 -->
                        <small class="text-muted">請輸入 10 位數字的手機號碼</small>
                    </div>

                    <!-- 收貨地址欄位 -->
                    <div class="mb-3">
                        <label for="shippingAddress" class="form-label">
                            收貨地址 <span class="required">*</span>
                        </label>
                        <!-- <textarea> 是多行文字輸入框 -->
                        <!-- rows 設定顯示的行數 -->
                        <textarea class="form-control" 
                                  id="shippingAddress" 
                                  name="shippingAddress" 
                                  rows="3" 
                                  placeholder="請輸入完整的收貨地址" 
                                  required></textarea>
                    </div>

                    <!-- 訂單備註欄位（選填） -->
                    <div class="mb-3">
                        <label for="orderNote" class="form-label">
                            訂單備註（選填）
                        </label>
                        <!-- 沒有 required 屬性，表示選填 -->
                        <textarea class="form-control" 
                                  id="orderNote" 
                                  name="orderNote" 
                                  rows="2" 
                                  placeholder="如有特殊需求，請在此說明"></textarea>
                    </div>

                    <!-- 提交按鈕 -->
                    <div class="d-grid">  <!-- d-grid 讓按鈕佔滿整行 -->
                        <!-- type="submit" 表示這是提交按鈕 -->
                        <!-- 點擊後會提交表單到 th:action 指定的 URL -->
                        <button type="submit" class="btn btn-success btn-lg">
                            <i class="bi bi-check-circle"></i> 確認訂單
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- 右側：訂單摘要 -->
        <div class="col-md-5">
            <div class="checkout-card">
                <h3 class="mb-3">訂單摘要</h3>
                
                <!-- TODO: 從購物車取得資料 -->
                <!-- 這裡需要在 Controller 中將購物車資料傳遞到頁面 -->
                
                <!-- 暫時顯示提示訊息 -->
                <div class="alert alert-info">
                    <i class="bi bi-info-circle"></i>
                    <p>購物車商品將在此顯示</p>
                </div>
                
                <!-- 
                未來可以這樣顯示購物車內容：
                <div th:each="item : ${cart.cartItems}" class="border-bottom pb-2 mb-2">
                    <div class="d-flex justify-content-between">
                        <span th:text="${item.product.prodName}">產品名稱</span>
                        <span th:text="'x' + ${item.quantity}">x1</span>
                    </div>
                    <div class="text-muted">
                        <small th:text="'$' + ${item.unitPrice} + ' x ' + ${item.quantity}"></small>
                    </div>
                </div>
                -->
                
                <!-- 總金額 -->
                <div class="border-top pt-3 mt-3">
                    <div class="d-flex justify-content-between">
                        <h5>訂單總額：</h5>
                        <!-- 
                        未來顯示總金額：
                        <h5 class="text-success" th:text="'$' + ${cart.totalAmount}">$0</h5>
                        -->
                        <h5 class="text-success">$0</h5>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- 引入 Bootstrap JavaScript（必須放在 body 結尾） -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- 表單驗證 JavaScript -->
<script>
// 當 DOM 載入完成後執行
document.addEventListener('DOMContentLoaded', function() {
    // 取得表單元素
    // document.querySelector() 選取符合條件的第一個元素
    var form = document.querySelector('form');
    
    // 監聽表單提交事件
    // addEventListener() 註冊事件監聽器
    form.addEventListener('submit', function(event) {
        // 檢查表單是否有效
        // checkValidity() 是 HTML5 的表單驗證方法
        if (!form.checkValidity()) {
            // 如果無效，阻止表單提交
            event.preventDefault();  // 阻止預設行為（提交表單）
            event.stopPropagation();  // 停止事件傳播
        }
        
        // 添加 Bootstrap 的驗證樣式
        // classList.add() 添加 CSS 類別
        form.classList.add('was-validated');
    }, false);  // false 表示在冒泡階段處理事件
});
</script>

</body>
</html>