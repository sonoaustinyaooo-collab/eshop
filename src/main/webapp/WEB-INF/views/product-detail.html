<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${product.prodName} + ' - 商品詳情'">商品詳情</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css">
    <style>
        /* ===== 頁面整體樣式 ===== */
        body {
            background-color: #f8f9fa;
        }
        
        .product-detail-container {
            margin-top: 2rem;
            margin-bottom: 4rem;
        }
        
        /* ===== 麵包屑導航 ===== */
        .breadcrumb {
            background-color: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        /* ===== 主要內容區 ===== */
        .detail-card {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        /* ===== 商品圖片樣式 ===== */
        .product-image-container {
            background-color: #f8f9fa;
            padding: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 500px;
        }
        
        .product-detail-image {
            max-width: 100%;
            max-height: 500px;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .product-image-placeholder {
            width: 100%;
            height: 500px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
        }
        
        /* ===== 商品資訊區 ===== */
        .product-info-container {
            padding: 2rem;
        }
        
        .product-title {
            font-size: 2rem;
            font-weight: 700;
            color: #212529;
            margin-bottom: 1rem;
        }
        
        .product-meta {
            margin-bottom: 1.5rem;
        }
        
        .product-meta .badge {
            font-size: 0.9rem;
            padding: 0.5rem 1rem;
            margin-right: 0.5rem;
        }
        
        /* ===== 價格顯示 ===== */
        .price-section {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
        }
        
        .price-label {
            font-size: 1rem;
            opacity: 0.9;
            margin-bottom: 0.5rem;
        }
        
        .price-display {
            font-size: 2.5rem;
            font-weight: 700;
        }
        
        /* ===== 資訊區塊 ===== */
        .info-section {
            background-color: #f8f9fa;
            border-left: 4px solid #007bff;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-radius: 4px;
        }
        
        .info-section h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #495057;
            margin-bottom: 1rem;
        }
        
        .info-section .info-item {
            display: flex;
            padding: 0.5rem 0;
            border-bottom: 1px solid #dee2e6;
        }
        
        .info-section .info-item:last-child {
            border-bottom: none;
        }
        
        .info-section .info-label {
            font-weight: 600;
            width: 120px;
            color: #6c757d;
        }
        
        .info-section .info-value {
            flex: 1;
            color: #212529;
        }
        
        /* ===== 商品描述 ===== */
        .description-section {
            background-color: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .description-section h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #495057;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #007bff;
        }
        
        .description-content {
            white-space: pre-wrap;
            line-height: 1.8;
            color: #495057;
        }
        
        /* ===== 操作按鈕 ===== */
        .action-section {
            position: sticky;
            top: 20px;
            background-color: white;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 1.5rem;
        }
        
        .quantity-selector {
            margin-bottom: 1rem;
        }
        
        .quantity-selector label {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .quantity-selector input {
            font-size: 1.1rem;
            text-align: center;
        }
        
        .btn-add-cart {
            font-size: 1.1rem;
            padding: 0.75rem;
            font-weight: 600;
        }
        
        /* ===== 管理員操作區 ===== */
        .admin-actions {
            background-color: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }
        
        .admin-actions h5 {
            font-size: 1rem;
            margin-bottom: 0.75rem;
            color: #856404;
        }
        
        /* ===== 響應式設計 ===== */
        @media (max-width: 768px) {
            .product-title {
                font-size: 1.5rem;
            }
            
            .price-display {
                font-size: 2rem;
            }
            
            .product-image-container {
                min-height: 300px;
            }
            
            .action-section {
                position: static;
                margin-top: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container product-detail-container">
        
        <!-- ===== 麵包屑導航 ===== -->
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item">
                    <a th:href="@{/}">
                        <i class="bi bi-house-door"></i> 首頁
                    </a>
                </li>
                <li class="breadcrumb-item">
                    <a th:href="@{/products}">
                        <i class="bi bi-shop"></i> 產品列表
                    </a>
                </li>
                <li class="breadcrumb-item active" aria-current="page" th:text="${product.prodName}">
                    商品名稱
                </li>
            </ol>
        </nav>
        
        <!-- ===== 主要內容區 ===== -->
        <div class="detail-card">
            <div class="row g-0">
                
                <!-- ========== 左側：商品圖片 ========== -->
                <div class="col-lg-6">
                    <div class="product-image-container">
                        <!-- 如果有圖片，顯示實際圖片 -->
                        <img th:if="${product.hasImage()}"
                             th:src="@{/resources/images/products/{img}(img=${product.prodImage})}" 
                             th:alt="${product.prodName}"
                             class="product-detail-image">
                        
                        <!-- 如果沒有圖片，顯示預設圖示 -->
                        <div th:if="${!product.hasImage()}" class="product-image-placeholder">
                            <i class="bi bi-box-seam" style="font-size: 8rem; color: white;"></i>
                        </div>
                    </div>
                </div>
                
                <!-- ========== 右側：商品資訊 ========== -->
                <div class="col-lg-6">
                    <div class="product-info-container">
                        
                        <!-- 商品名稱 -->
                        <h1 class="product-title" th:text="${product.prodName}">商品名稱</h1>
                        
                        <!-- 商品類型和產品線 -->
                        <div class="product-meta">
                            <span class="badge bg-secondary" th:text="${product.prodType}">類型</span>
                            <span class="badge bg-info" th:if="${product.prodLine != null and !product.prodLine.isEmpty()}" 
                                  th:text="${product.prodLine}">產品線</span>
                        </div>
                        
                        <!-- 商品編號 -->
                        <div class="info-section">
                            <div class="info-item">
                                <span class="info-label">
                                    <i class="bi bi-hash"></i> 商品編號
                                </span>
                                <span class="info-value" th:text="${product.prodNum}">0</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">
                                    <i class="bi bi-tag"></i> 商品類型
                                </span>
                                <span class="info-value" th:text="${product.prodType}">類型</span>
                            </div>
                            <div class="info-item" th:if="${product.prodLine != null and !product.prodLine.isEmpty()}">
                                <span class="info-label">
                                    <i class="bi bi-diagram-3"></i> 產品線
                                </span>
                                <span class="info-value" th:text="${product.prodLine}">產品線</span>
                            </div>
                        </div>
                        
                        <!-- 商品價格 -->
                        <div class="price-section">
                            <div class="price-label">
                                <i class="bi bi-currency-dollar"></i> 商品價格
                            </div>
                            <div class="price-display">
                                NT$ <span th:text="${#numbers.formatDecimal(product.prodPrice, 0, 'COMMA', 0, 'POINT')}">0</span>
                            </div>
                        </div>
                        <!-- ========== 操作區域 ========== -->
                        <div class="action-section">
                        
                        <!-- 加入購物車表單 -->
                        <form th:action="@{/cart/add}" method="post">
                            <input type="hidden" name="productId" th:value="${product.prodNum}">
                            
                            <!-- 數量選擇 -->
                            <div class="quantity-selector">
                                <label for="quantity" class="form-label">
                                    <i class="bi bi-basket"></i> 購買數量
                                </label>
                                <input type="number" 
                                       class="form-control form-control-lg" 
                                       id="quantity"
                                       name="quantity" 
                                       value="1" 
                                       min="1" 
                                       max="99">
                            </div>
                            
                            <!-- 加入購物車按鈕 -->
                            <button type="submit" class="btn btn-success btn-add-cart w-100 mb-2">
                                <i class="bi bi-cart-plus"></i> 加入購物車
                            </button>
                        </form>
                        
                        <!-- 返回列表按鈕 -->
                        <a th:href="@{/products}" class="btn btn-outline-secondary w-100">
                            <i class="bi bi-arrow-left"></i> 返回產品列表
                        </a>
                        
                        <!-- ========== 管理員操作按鈕（只有管理員可見） ========== -->
                        <div th:if="${session.userType == 'admin'}" class="admin-actions">
                            <h5>
                                <i class="bi bi-shield-lock"></i> 管理員操作
                            </h5>
                            <div class="btn-group w-100" role="group">
                                <a th:href="@{/products/edit/{id}(id=${product.prodNum})}" 
                                   class="btn btn-warning">
                                    <i class="bi bi-pencil"></i> 編輯
                                </a>
                                <a th:href="@{/products/delete/{id}(id=${product.prodNum})}" 
                                   class="btn btn-danger"
                                   onclick="return confirm('確定要刪除此商品嗎？刪除後將無法復原！')">
                                    <i class="bi bi-trash"></i> 刪除
                                </a>
                            </div>
                        </div>
                        
                    </div>
                    <!-- ========== 操作區域結束 ========== -->
                    
                </div>
            </div>
            
        </div>
    </div>
    
    <!-- ========== 商品詳細說明 ========== -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="description-section">
                <h3>
                    <i class="bi bi-card-text"></i> 商品說明
                </h3>
                
                <!-- 如果有描述，顯示實際內容 -->
                <div th:if="${product.hasDescription()}">
                    <div class="description-content" th:text="${product.prodDescription}">
                        產品描述內容
                    </div>
                </div>
                
                <!-- 如果沒有描述，顯示預設訊息 -->
                <div th:if="${!product.hasDescription()}" class="text-muted">
                    <i class="bi bi-info-circle"></i> 此商品尚無詳細說明。
                </div>
            </div>
        </div>
    </div>
    
    <!-- ========== 推薦商品區域（預留，未來可擴充） ========== -->
    <div class="row mt-5">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <h3 class="card-title mb-4">
                        <i class="bi bi-stars"></i> 推薦商品
                    </h3>
                    <p class="text-muted">
                        <i class="bi bi-info-circle"></i> 此區域將顯示相同類型的其他推薦商品
                    </p>
                    <!-- 未來可以在這裡加入推薦商品的邏輯 -->
                </div>
            </div>
        </div>
    </div>
    
</div>

<!-- ===== JavaScript ===== -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
    /**
     * 數量輸入驗證
     * 
     * 功能說明：
     * 確保使用者輸入的數量在有效範圍內（1-99）
     */
    document.addEventListener('DOMContentLoaded', function() {
        const quantityInput = document.getElementById('quantity');
        
        if (quantityInput) {
            quantityInput.addEventListener('change', function() {
                let value = parseInt(this.value);
                
                // 如果輸入不是數字或小於1，設定為1
                if (isNaN(value) || value < 1) {
                    this.value = 1;
                }
                
                // 如果輸入大於99，設定為99
                if (value > 99) {
                    this.value = 99;
                }
            });
        }
    });
    
    /**
     * 加入購物車成功提示（可選）
     * 
     * 如果你的後端有設定 success 訊息，可以在這裡顯示
     */
    document.addEventListener('DOMContentLoaded', function() {
        // 檢查 URL 參數是否有 success
        const urlParams = new URLSearchParams(window.location.search);
        const success = urlParams.get('success');
        
        if (success === 'cart') {
            // 可以在這裡顯示成功訊息
            // 例如使用 Bootstrap Toast 或 Alert
            console.log('已成功加入購物車');
        }
    });
    
    /**
     * 圖片放大功能（可選）
     * 
     * 點擊圖片時放大顯示
     */
    document.addEventListener('DOMContentLoaded', function() {
        const productImage = document.querySelector('.product-detail-image');
        
        if (productImage) {
            productImage.style.cursor = 'pointer';
            
            productImage.addEventListener('click', function() {
                // 建立模態視窗顯示大圖
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background-color: rgba(0,0,0,0.9);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 9999;
                    cursor: pointer;
                `;
                
                const img = document.createElement('img');
                img.src = this.src;
                img.style.cssText = `
                    max-width: 90%;
                    max-height: 90%;
                    object-fit: contain;
                `;
                
                modal.appendChild(img);
                document.body.appendChild(modal);
                
                // 點擊背景關閉
                modal.addEventListener('click', function() {
                    document.body.removeChild(modal);
                });
            });
        }
    });
    
    /**
     * 平滑滾動到描述區域（可選）
     * 
     * 如果頁面很長，可以加入一個「查看說明」按鈕
     * 點擊後平滑滾動到描述區域
     */
    function scrollToDescription() {
        const descSection = document.querySelector('.description-section');
        if (descSection) {
            descSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    }
</script>
</body>
</html>                                                            